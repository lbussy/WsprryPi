<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Web Server JSON Tester</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        input,
        textarea {
            width: 100%;
            margin: 10px 0;
            padding: 8px;
            box-sizing: border-box;
        }

        button {
            padding: 10px 20px;
            margin: 10px 0;
            font-size: 1em;
        }

        pre {
            background: #f4f4f4;
            padding: 10px;
            border: 1px solid #ccc;
            overflow-x: auto;
        }
    </style>
</head>

<body>
    <h1>Web Server JSON Tester</h1>

    <label for="portInput">Port (default 31415):</label>
    <input type="number" id="portInput" value="31415" min="1024" max="65535">

    <h2>GET JSON from Server</h2>
    <button id="getBtn">GET JSON</button>
    <pre id="getOutput">GET output will appear here.</pre>

    <hr>

    <h2>Send JSON to Server (PUT/PATCH)</h2>
    <label for="jsonInput">JSON Payload:</label>
    <textarea id="jsonInput" rows="10">
{
  "exampleKey": "exampleValue"
}
  </textarea>
    <button id="sendBtn">Send JSON</button>
    <pre id="sendOutput">Send output will appear here.</pre>

    <script>
        // Get DOM elements.
        const portInput = document.getElementById('portInput');
        const getBtn = document.getElementById('getBtn');
        const getOutput = document.getElementById('getOutput');
        const jsonInput = document.getElementById('jsonInput');
        const sendBtn = document.getElementById('sendBtn');
        const sendOutput = document.getElementById('sendOutput');

        // GET button click event.
        getBtn.addEventListener('click', () => {
            const port = portInput.value || "31415";
            fetch(`http://localhost:${port}/`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok: " + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    getOutput.textContent = JSON.stringify(data, null, 4);
                })
                .catch(error => {
                    getOutput.textContent = "Error: " + error;
                });
        });

        // Send button click event.
        sendBtn.addEventListener('click', () => {
            const port = portInput.value || "31415";
            let payload;
            try {
                payload = JSON.parse(jsonInput.value);
            } catch (e) {
                sendOutput.textContent = "Invalid JSON: " + e;
                return;
            }

            fetch(`http://localhost:${port}/`, {
                method: "PUT", // Change to PATCH if required by your server.
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(payload)
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok: " + response.statusText);
                    }
                    return response.text();
                })
                .then(data => {
                    sendOutput.textContent = data;
                })
                .catch(error => {
                    sendOutput.textContent = "Error: " + error;
                });
        });
    </script>
</body>

</html>
